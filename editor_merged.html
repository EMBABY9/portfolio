<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SIMBA - Merged Editor</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/geotiff@2.0.7/dist/geotiff.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" crossorigin=""></script>

  <style>
    :root {
      --space-dark: #0a0a1a;
      --space-blue: #1a1a2e;
      --space-indigo: #16213e;
      --space-purple: #331b3f;
      --accent-cyan: #00eeff;
      --accent-purple: #7b2cbf;
      --accent-pink: #ff2a6d;
      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.7);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body, html {
      height: 100%;
      font-family: 'Roboto', sans-serif;
      background-color: var(--space-dark);
      color: var(--text-primary);
      overflow-x: hidden;
    }

    .space-background { position: fixed; width: 100vw; height: 100vh; top: 0; left: 0; z-index: -1;
      background: linear-gradient(45deg, var(--space-dark), var(--space-blue), var(--space-indigo), var(--space-purple));
      background-size: 400% 400%; animation: gradientBG 15s ease infinite; overflow: hidden; }
    @keyframes gradientBG { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
    #stars,#stars2,#stars3{position:absolute;top:0;left:0;width:100%;height:100%;z-index:1;pointer-events:none}
    .star{position:absolute;background:white;border-radius:50%;z-index:1}
    .planet{position:absolute;border-radius:50%;filter:drop-shadow(0 0 10px rgba(255,255,255,.2));pointer-events:none;opacity:.7}
    #sun{width:150px;height:150px;top:5%;left:8%;background:radial-gradient(circle at 30% 40%,#ffd700,#ff4500);box-shadow:0 0 30px #ff4500;animation:float 20s ease-in-out infinite}
    #mercury{width:15px;height:15px;top:18%;left:18%;background:radial-gradient(circle at 30% 40%,#a0522d,#8b4513);animation:orbit 8s linear infinite, float 15s ease-in-out infinite}
    #venus{width:25px;height:25px;top:25%;left:25%;background:radial-gradient(circle at 30% 40%,#deb887,#d2691e);animation:orbit 12s linear infinite, float 18s ease-in-out infinite}
    #earth{width:30px;height:30px;top:35%;left:35%;background:radial-gradient(circle at 30% 40%,#4169e1,#000080);animation:orbit 15s linear infinite, float 20s ease-in-out infinite}
    #mars{width:20px;height:20px;bottom:10%;right:15%;background:radial-gradient(circle at 30% 40%,#cd5c5c,#8b0000);animation:orbit 20s linear infinite, float 22s ease-in-out infinite}
    #jupiter{width:80px;height:80px;bottom:5%;left:5%;background:radial-gradient(circle at 30% 40%,#deb887,#8b4513);animation:orbit 30s linear infinite, float 25s ease-in-out infinite}
    #saturn{width:60px;height:60px;top:15%;right:10%;background:radial-gradient(circle at 30% 40%,#f4a460,#8b4513);animation:orbit 35s linear infinite, float 28s ease-in-out infinite}
    @keyframes orbit{from{transform:rotate(0deg) translateX(40px) rotate(0deg)} to{transform:rotate(360deg) translateX(40px) rotate(-360deg)}}
    @keyframes float{0%,100%{transform:translateY(0)} 50%{transform:translateY(-15px)}}

    .container { background: rgba(10,10,26,0.9); backdrop-filter: blur(10px); border-radius: 15px; box-shadow: 0 0 50px rgba(0,238,255,0.3);
      padding: 25px; margin: 20px auto; width: 95%; max-width: 1300px; min-height: calc(100vh - 40px); display: flex; flex-direction: column; gap: 20px; }

    .header { text-align: center; }
    .header h1 { font-family: 'Orbitron', sans-serif; font-size: 2.2em; color: var(--accent-cyan); text-shadow: 0 0 15px rgba(0,238,255,0.7); }
    .header p { color: var(--text-secondary); margin-top: 6px; }

    .actions-row { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin-top: 12px; }
    .btn { background: linear-gradient(45deg, #00eeff, #00aaff); color: #0a0a1a; border: none; padding: 10px 18px; border-radius: 18px; cursor: pointer; font-weight: 700; box-shadow: 0 5px 15px rgba(0,238,255,0.4); }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,238,255,0.6); }

    .main-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
    @media (min-width: 1024px) { .main-grid { grid-template-columns: 1fr 1fr; } }

    .panel { background: rgba(26,26,46,0.7); border: 1px solid rgba(0,238,255,0.2); border-radius: 10px; padding: 15px; box-shadow: 0 0 20px rgba(0, 238, 255, 0.15); }
    .panel h2 { font-family: 'Orbitron', sans-serif; font-size: 1.2em; color: var(--accent-cyan); margin-bottom: 10px; }

    .canvas-container { position: relative; background-color: #1a1a2e; border: 2px solid var(--accent-cyan); border-radius: 10px; overflow: hidden; display: flex; align-items: center; justify-content: center; min-height: 380px; max-height: 70vh; }
    canvas { display: block; max-width: 100%; max-height: 100%; cursor: crosshair; }

    .controls { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 12px; }
    .control-group { flex: 1 1 250px; background: rgba(10,10,26,0.6); border: 1px solid rgba(0,238,255,0.15); border-radius: 8px; padding: 12px; }
    .control-group label { color: var(--accent-cyan); font-weight: 700; font-size: 0.9em; display: block; margin-bottom: 6px; }
    .control-group input[type="range"], .control-group select, .control-group input[type="number"] { width: 100%; background-color: #0a0a1a; border: 1px solid var(--accent-cyan); border-radius: 6px; padding: 8px; color: var(--text-primary); }
    .control-group .button-row { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }

    .legend { margin-top: 10px; background: rgba(10,10,26,0.6); border: 1px solid rgba(0,238,255,0.2); border-radius: 8px; padding: 10px; }
    .legend-item { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
    .legend-item .swatch { width: 14px; height: 14px; border-radius: 50%; border: 1px solid #ccc; }

    .message-inline { margin-top: 10px; padding: 10px; border-radius: 8px; border: 1px solid rgba(0,238,255,0.25); background: rgba(0,238,255,0.08); color: #b9f6ff; display: none; }
    .message-inline.error { border-color: rgba(255, 82, 82, 0.5); background: rgba(255, 82, 82, 0.08); color: #ffbaba; }

    .loader { border: 4px solid rgba(255,255,255,0.1); border-top: 4px solid var(--accent-cyan); border-radius: 50%; width: 36px; height: 36px; animation: spin 1s linear infinite; display: none; margin: 10px auto; }
    @keyframes spin { 0%{transform: rotate(0)} 100%{transform: rotate(360deg)} }

    .selection-box { position: absolute; border: 2px dashed #ffcc00; background-color: rgba(255,204,0,0.2); pointer-events: none; }

    /* Message Box Overlay (reused) */
    .message-box-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 1000; }
    .message-box { background: #1a1a2e; color: #e2e8f0; padding: 26px; border-radius: 14px; box-shadow: 0 0 30px rgba(0,238,255,0.5); text-align: center; border: 2px solid #00eeff; }
    .message-box h3 { margin-top: 0; color: #00eeff; font-size: 1.3em; margin-bottom: 12px; }

    /* Map */
    #map-container { width: 100%; height: 380px; background-color: #1a1a2e; border: 2px solid var(--accent-cyan); border-radius: 10px; box-shadow: 0 0 20px rgba(0, 238, 255, 0.4); display: none; overflow: hidden; }
    #map { width: 100%; height: 100%; }
  </style>
</head>
<body>
  <div class="space-background">
    <div id="stars"></div>
    <div id="stars2"></div>
    <div id="stars3"></div>
    <div id="sun" class="planet"></div>
    <div id="mercury" class="planet"></div>
    <div id="venus" class="planet"></div>
    <div id="earth" class="planet"></div>
    <div id="mars" class="planet"></div>
    <div id="jupiter" class="planet"></div>
    <div id="saturn" class="planet"></div>
  </div>

  <div class="container">
    <div class="header">
      <h1>SIMBA Image Editor</h1>
      <div class="actions-row">
        <input type="file" id="imageUpload" accept="image/*, .tif, .tiff" style="display:none" />
        <button class="btn" id="uploadNewImageButton">Upload  image (jpg,png)</button>
        <input type="file" id="fileInputBackend" accept=".tif,.tiff" style="display:none" />
        <button class="btn" id="uploadTiffButton">Upload TIFF</button>
      </div>
    </div>

    <div class="main-grid">
      <!-- Left: Canvas editor (client-side) -->
      <div class="panel">
        <h2>Canvas Editor</h2>
        <div class="canvas-container" id="canvasContainer">
          <button class="btn" id="canvasPanMapButton" style="position:absolute;top:12px;left:12px;z-index:10;">Pan الخريطة</button>
          <canvas id="imageCanvas"></canvas>
        </div>
        <div class="controls">
          <div class="control-group">
            <label>Color Adjustments</label>
            <label for="brightness">Brightness</label>
            <input type="range" id="brightness" min="-100" max="100" value="0" />
            <div class="button-row">
              <button class="btn" id="applyAdjustmentsButton">Apply</button>
              <button class="btn" id="invertColorsButton">Invert</button>
            </div>
          </div>

          

          <div class="control-group">
            <label for="colorizeSelect">Color Map (Local)</label>
            <select id="colorizeSelect">
              <option value="none">Original / None</option>
              <option value="jet">Jet</option>
              <option value="viridis">Viridis</option>
              <option value="grayscale">Grayscale</option>
              <option value="hot">Hot</option>
              <option value="cool">Cool</option>
            </select>
            <div class="button-row"><button class="btn" id="applyColorMapButtonLocal">Apply</button></div>
          </div>

          <div class="control-group">
            <label>Cropping & Geometric</label>
            <p style="color:var(--text-secondary);font-size:0.9em;">Drag to select an area, then Crop.</p>
            <div class="button-row">
              <button class="btn" id="cropButton">Crop</button>
              <button class="btn" id="rotateButton">Rotate 90°</button>
            </div>
            <div class="button-row">
              <button class="btn" id="flipHorizontalButton">Flip Horizontal</button>
              <button class="btn" id="resetCanvasButton">Reset</button>
            </div>
          </div>

          

          <div class="control-group">
            <label>Zoom</label>
            <div class="button-row">
              <button class="btn" id="zoomInButton">Zoom In</button>
              <button class="btn" id="zoomOutButton">Zoom Out</button>
              <button class="btn" id="toggleMapButton">Toggle Map</button>
              <button class="btn" id="panMapButton">Pan</button>
            </div>
          </div>
        </div>

        <div style="text-align:center;margin-top:10px;">
          <button class="btn" id="saveButton">Download Edited Image (PNG)</button>
        </div>

        <div id="map-container"><div id="map"></div></div>
      </div>

      <!-- Right: Server tools (from edit.html) -->
      <div class="panel">
        <h2>Server Processing</h2>

        <div class="control-group">
          <label>Clip Image</label>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
            <div>
              <label for="clipMinX">Min X</label>
              <input type="number" id="clipMinX" placeholder="0" />
            </div>
            <div>
              <label for="clipMinY">Min Y</label>
              <input type="number" id="clipMinY" placeholder="0" />
            </div>
            <div>
              <label for="clipMaxX">Max X</label>
              <input type="number" id="clipMaxX" placeholder="100" />
            </div>
            <div>
              <label for="clipMaxY">Max Y</label>
              <input type="number" id="clipMaxY" placeholder="100" />
            </div>
          </div>
          <div class="button-row"><button class="btn" id="clipButton">Apply Clip</button></div>
        </div>

        <div class="control-group">
          <label>Classification</label>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
            <div>
              <label for="numClasses">Number of Classes</label>
              <input type="number" id="numClasses" value="5" min="2" max="20" />
            </div>
            <div>
              <label for="classificationMethod">Method</label>
              <select id="classificationMethod">
                <option value="kmeans">K-Means</option>
                <option value="jenks">Jenks</option>
              </select>
            </div>
          </div>
          <div class="button-row"><button class="btn" id="classifyButton">Apply Classification</button></div>
          <div id="classificationLegend" class="legend" style="display:none;"></div>
        </div>

        <div class="control-group">
          <label for="colorMapSelectServer">Color Map (Server)</label>
          <select id="colorMapSelectServer">
            <option value="viridis">Viridis</option>
            <option value="plasma">Plasma</option>
            <option value="inferno">Inferno</option>
            <option value="magma">Magma</option>
            <option value="cividis">Cividis</option>
            <option value="gray">Grayscale</option>
            <option value="jet">Jet</option>
          </select>
          <div class="button-row"><button class="btn" id="applyColorMapButtonServer">Apply Server Color Map</button></div>
        </div>

        <div class="control-group">
          <label>Server Preview</label>
          <div id="serverPreviewWrapper" style="position:relative;border:1px solid rgba(0,238,255,0.2);border-radius:8px;min-height:220px;display:flex;align-items:center;justify-content:center;background:#0f0f1f;overflow:hidden;">
            <img id="processedImagePreview" alt="Processed Preview" style="max-width:100%;height:auto;display:none;border-radius:6px;user-select:none;-webkit-user-drag:none;" />
            <div id="serverSelectionBox" class="selection-box" style="display:none;"></div>
            <p id="processedPlaceholder" style="color:var(--text-secondary);">Processed image will appear here.</p>
          </div>
          <div class="loader" id="loadingProcessed"></div>
          <div class="message-inline" id="processedMessageBox"></div>
          <div style="text-align:center;margin-top:10px;">
            <button class="btn" id="downloadButton" disabled>Download Processed TIFF</button>
          </div>
        </div>
      </div>
    </div>
  </div>

 
</body>
</html>


